import{r as $,d as C,s as B,a as i,u as D,b as L,j as e,B as T,c as F,e as I,f as N,g as z,h as y,i as H,k as _,l as E,m as O,L as K}from"./index-D8UNnogr.js";import{l as Q,a as S,b as G}from"./logger-BkU65TcE.js";import{T as p,S as W,A as k}from"./TextField-Cvw_-eYe.js";import{B as J}from"./Button-DhDvdlur.js";const M=async(a,{firstName:u,lastName:n,phone:m})=>{const l=a.uid,d=$(C,`users/${l}`);await B(d,{uid:l,email:a.email,firstName:u,lastName:n,phone:m||"",displayName:`${u} ${n}`,role:"member"})},V="_container_nsyie_1",X="_logo_nsyie_21",Y="_toggle_nsyie_33",Z="_active_nsyie_69",ee="_form_nsyie_79",se="_row_nsyie_91",ae="_input_nsyie_101",te="_submit_nsyie_109",r={container:V,logo:X,toggle:Y,active:Z,form:ee,row:se,input:ae,submit:te},re="/assets/logo_login-B1jKQqRT.png",oe=()=>{const[a,u]=i.useState(!0),[n,m]=i.useState(""),[l,d]=i.useState(""),[g,A]=i.useState(""),[x,P]=i.useState(""),[b,R]=i.useState(""),[w,U]=i.useState(""),f=D(),{t:s}=L(),[c,h]=i.useState({open:!1,message:"",severity:"success"}),q=async o=>{if(o.preventDefault(),!n||!l||!a&&(!x||!b||!g)){h({open:!0,message:s("authErrors.missing-fields"),severity:"error"});return}if(!a&&l!==g){h({open:!0,message:s("authErrors.password-mismatch"),severity:"error"});return}f(F(!0));try{let t;if(a){t=(await I(N,n,l)).user;const v=(await z($(C,`users/${t.uid}`))).val();if(v.active===!1){h({open:!0,message:s("authErrors.disabled-account"),severity:"error"}),Q(`Login attempt blocked for disabled user: ${n}`);return}f(y({uid:t.uid,email:t.email,displayName:`${v.firstName} ${v.lastName}`,photoURL:t.photoURL||null,role:v.role,active:v.active!==!1})),h({open:!0,message:s("authSuccess.login"),severity:"success"}),S(`User logged in: ${n} (${t.uid})`)}else t=(await H(N,n,l)).user,await M(t,{firstName:x,lastName:b,phone:w}),f(y({uid:t.uid,email:t.email,displayName:`${x} ${b}`,photoURL:t.photoURL||null,role:"member"})),h({open:!0,message:s("authSuccess.register"),severity:"success"}),S(`New user registered: ${n} (${t.uid})`);f(_(null))}catch(t){const j=t.code||"unknown";f(_(j)),G(`Auth error [${a?"login":"register"}]:`,j,t.message||t)}};return e.jsxs("div",{className:r.container,children:[e.jsx("img",{src:re,alt:"Logo",className:r.logo}),e.jsxs("div",{className:r.toggle,children:[e.jsx("button",{className:a?r.active:"",onClick:()=>u(!0),children:s("login.title")}),e.jsx("button",{className:a?"":r.active,onClick:()=>u(!1),children:s("register.title")})]}),e.jsxs(T,{component:"form",onSubmit:q,className:r.form,children:[!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:r.row,children:[e.jsx(p,{label:s("form.firstname"),fullWidth:!0,margin:"normal",value:x,onChange:o=>P(o.target.value),required:!0,className:r.input}),e.jsx(p,{label:s("form.lastname"),fullWidth:!0,margin:"normal",value:b,onChange:o=>R(o.target.value),required:!0,className:r.input})]}),e.jsxs("div",{className:r.row,children:[e.jsx(p,{label:s("form.phone"),fullWidth:!0,margin:"normal",value:w,onChange:o=>U(o.target.value),className:r.input}),e.jsx(p,{label:s("form.email"),fullWidth:!0,margin:"normal",value:n,onChange:o=>m(o.target.value),required:!0,className:r.input})]})]}),a&&e.jsx(p,{label:s("form.email"),fullWidth:!0,margin:"normal",value:n,onChange:o=>m(o.target.value),required:!0,className:r.input}),e.jsx(p,{label:s("form.password"),type:"password",fullWidth:!0,margin:"normal",value:l,onChange:o=>d(o.target.value),required:!0,className:r.input}),!a&&e.jsx(p,{label:s("form.repeatPassword"),type:"password",fullWidth:!0,margin:"normal",value:g,onChange:o=>A(o.target.value),required:!0,className:r.input}),e.jsx(J,{type:"submit",fullWidth:!0,variant:"contained",className:r.submit,children:s(a?"login.button":"register.button")})]}),e.jsx(W,{open:c.open,autoHideDuration:4e3,onClose:()=>h({...c,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(k,{role:"alert",severity:c.severity,onClose:()=>h({...c,open:!1}),sx:{width:"100%"},children:s(`authErrors.${c.message}`)!==`authErrors.${c.message}`?s(`authErrors.${c.message}`):c.message})})]})},me=()=>{const a=E(g=>g.auth.user),u=E(g=>g.auth.error),n=O(),{t:m}=L(),[l,d]=i.useState(!1);return i.useEffect(()=>{a&&n(a.role==="admin"?"/admin":"/dashboard")},[a,n]),i.useEffect(()=>{u&&d(!0)},[u]),e.jsxs("div",{className:"login-page-container",children:[e.jsx("div",{className:"language-select",children:e.jsx(K,{})}),e.jsx("div",{className:"form-wrapper",children:e.jsx(oe,{})}),e.jsx(W,{open:l,autoHideDuration:5e3,onClose:()=>d(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(k,{severity:"error",onClose:()=>d(!1),sx:{width:"100%"},children:m(`authErrors.${u}`)||m("authErrors.default")})})]})};export{me as default};

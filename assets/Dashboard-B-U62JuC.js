import{a as s,n as Y,o as Z,p as ee,q as F,T as N,j as t,t as H,v as te,w as oe,x as me,y as ie,z as J,A as fe,C as ce,D as z,E as ve,F as be,b as ae,B as V,I as xe,M as Ce,G as q,g as je,r as W,d as I,H as ye,l as de,J as ue,K as Be,N as $e,O as Se,s as pe,m as we,P as Re}from"./index-CSb_6Ykt.js";import{C as Pe,a as ke,T as Te,D as Me,b as Oe,c as Ne,A as Ae,d as ze,S as K,F as De,e as Le}from"./Folder---8j8c3p.js";import{a as se,b as Q}from"./logger-BkU65TcE.js";import{T as U,S as We,A as Ie}from"./TextField-DwG2R8mL.js";import{B as X}from"./Button-pSMyGxEo.js";import"./useThemeProps-D1nHMFCe.js";function _e(e){return s.Children.toArray(e).filter(a=>s.isValidElement(a))}function Fe(e){return Z("MuiCardHeader",e)}const E=Y("MuiCardHeader",["root","avatar","action","content","title","subheader"]),He=e=>{const{classes:a}=e;return te({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},Fe,a)},Ge=H("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,a)=>[{[`& .${E.title}`]:a.title},{[`& .${E.subheader}`]:a.subheader},a.root]})({display:"flex",alignItems:"center",padding:16}),Ue=H("div",{name:"MuiCardHeader",slot:"Avatar"})({display:"flex",flex:"0 0 auto",marginRight:16}),Ve=H("div",{name:"MuiCardHeader",slot:"Action"})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),qe=H("div",{name:"MuiCardHeader",slot:"Content"})({flex:"1 1 auto",[`.${oe.root}:where(& .${E.title})`]:{display:"block"},[`.${oe.root}:where(& .${E.subheader})`]:{display:"block"}}),Ee=s.forwardRef(function(a,d){const o=ee({props:a,name:"MuiCardHeader"}),{action:n,avatar:c,component:$="div",disableTypography:B=!1,subheader:R,subheaderTypographyProps:P,title:f,titleTypographyProps:u,slots:g={},slotProps:v={},...S}=o,C={...o,component:$,disableTypography:B},b=He(C),w={slots:g,slotProps:{title:u,subheader:P,...v}};let j=f;const[l,x]=F("title",{className:b.title,elementType:N,externalForwardedProps:w,ownerState:C,additionalProps:{variant:c?"body2":"h5",component:"span"}});j!=null&&j.type!==N&&!B&&(j=t.jsx(l,{...x,children:j}));let h=R;const[k,y]=F("subheader",{className:b.subheader,elementType:N,externalForwardedProps:w,ownerState:C,additionalProps:{variant:c?"body2":"body1",color:"textSecondary",component:"span"}});h!=null&&h.type!==N&&!B&&(h=t.jsx(k,{...y,children:h}));const[r,T]=F("root",{ref:d,className:b.root,elementType:Ge,externalForwardedProps:{...w,...S,component:$},ownerState:C}),[M,i]=F("avatar",{className:b.avatar,elementType:Ue,externalForwardedProps:w,ownerState:C}),[p,O]=F("content",{className:b.content,elementType:qe,externalForwardedProps:w,ownerState:C}),[A,_]=F("action",{className:b.action,elementType:Ve,externalForwardedProps:w,ownerState:C});return t.jsxs(r,{...T,children:[c&&t.jsx(M,{...i,children:c}),t.jsxs(p,{...O,children:[j,h]}),n&&t.jsx(A,{..._,children:n})]})});function Je(e){return Z("MuiToggleButton",e)}const L=Y("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),ge=s.createContext({}),he=s.createContext(void 0);function Ke(e,a){return a===void 0||e===void 0?!1:Array.isArray(a)?a.includes(e):e===a}const Qe=e=>{const{classes:a,fullWidth:d,selected:o,disabled:n,size:c,color:$}=e,B={root:["root",o&&"selected",n&&"disabled",d&&"fullWidth",`size${J(c)}`,$]};return te(B,Je,a)},Xe=H(fe,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:d}=e;return[a.root,a[`size${J(d.size)}`]]}})(ce(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${L.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:z(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${L.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:z(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:z(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:z(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(ve()).map(([a])=>({props:{color:a},style:{[`&.${L.selected}`]:{color:(e.vars||e).palette[a].main,backgroundColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:z(e.palette[a].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:z(e.palette[a].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[a].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:z(e.palette[a].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),ne=s.forwardRef(function(a,d){const{value:o,...n}=s.useContext(ge),c=s.useContext(he),$=me({...n,selected:Ke(a.value,o)},a),B=ee({props:$,name:"MuiToggleButton"}),{children:R,className:P,color:f="standard",disabled:u=!1,disableFocusRipple:g=!1,fullWidth:v=!1,onChange:S,onClick:C,selected:b,size:w="medium",value:j,...l}=B,x={...B,color:f,disabled:u,disableFocusRipple:g,fullWidth:v,size:w},h=Qe(x),k=r=>{C&&(C(r,j),r.defaultPrevented)||S&&S(r,j)},y=c||"";return t.jsx(Xe,{className:ie(n.className,h.root,P,y),disabled:u,focusRipple:!g,ref:d,onClick:k,onChange:S,value:j,ownerState:x,"aria-pressed":b,...l,children:R})});function Ye(e){return Z("MuiToggleButtonGroup",e)}const m=Y("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Ze=e=>{const{classes:a,orientation:d,fullWidth:o,disabled:n}=e,c={root:["root",d,o&&"fullWidth"],grouped:["grouped",`grouped${J(d)}`,n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return te(c,Ye,a)},et=H("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:d}=e;return[{[`& .${m.grouped}`]:a.grouped},{[`& .${m.grouped}`]:a[`grouped${J(d.orientation)}`]},{[`& .${m.firstButton}`]:a.firstButton},{[`& .${m.lastButton}`]:a.lastButton},{[`& .${m.middleButton}`]:a.middleButton},a.root,d.orientation==="vertical"&&a.vertical,d.fullWidth&&a.fullWidth]}})(ce(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${m.grouped}`]:{[`&.${m.selected} + .${m.grouped}.${m.selected}`]:{borderTop:0,marginTop:0}},[`& .${m.firstButton},& .${m.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${m.lastButton},& .${m.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${m.lastButton}.${L.disabled},& .${m.middleButton}.${L.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${m.grouped}`]:{[`&.${m.selected} + .${m.grouped}.${m.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${m.firstButton},& .${m.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${m.lastButton},& .${m.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${m.lastButton}.${L.disabled},& .${m.middleButton}.${L.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),tt=s.forwardRef(function(a,d){const o=ee({props:a,name:"MuiToggleButtonGroup"}),{children:n,className:c,color:$="standard",disabled:B=!1,exclusive:R=!1,fullWidth:P=!1,onChange:f,orientation:u="horizontal",size:g="medium",value:v,...S}=o,C={...o,disabled:B,fullWidth:P,orientation:u,size:g},b=Ze(C),w=s.useCallback((y,r)=>{if(!f)return;const T=v&&v.indexOf(r);let M;v&&T>=0?(M=v.slice(),M.splice(T,1)):M=v?v.concat(r):[r],f(y,M)},[f,v]),j=s.useCallback((y,r)=>{f&&f(y,v===r?null:r)},[f,v]),l=s.useMemo(()=>({className:b.grouped,onChange:R?j:w,value:v,size:g,fullWidth:P,color:$,disabled:B}),[b.grouped,R,j,w,v,g,P,$,B]),x=_e(n),h=x.length,k=y=>{const r=y===0,T=y===h-1;return r&&T?"":r?b.firstButton:T?b.lastButton:b.middleButton};return t.jsx(et,{role:"group",className:ie(b.root,c),ref:d,ownerState:C,...S,children:t.jsx(ge.Provider,{value:l,children:x.map((y,r)=>t.jsx(he.Provider,{value:k(r),children:y},r))})})}),at=be(t.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),rt="_projectCard_iji1d_39",ot="_projectTitle_iji1d_73",st="_projectDescription_iji1d_85",nt="_membersList_iji1d_95",lt="_archivedCard_iji1d_135",it="_archivedBanner_iji1d_153",D={projectCard:rt,projectTitle:ot,projectDescription:st,membersList:nt,archivedCard:lt,archivedBanner:it},le=["#F44336","#3F51B5","#4CAF50","#FF9800","#9C27B0"],ct=e=>{const a=e.split("").reduce((d,o)=>d+o.charCodeAt(0),0)%le.length;return le[a]},dt=e=>{const a=e.trim().split(" ");return a.length===1?a[0].slice(0,2).toUpperCase():`${a[0][0]}${a[1][0]}`.toUpperCase()},ut=({id:e,name:a,description:d,goal:o,members:n,archived:c=!1,ownerId:$,currentUserId:B,onView:R,onEdit:P,onToggleArchive:f,onDelete:u})=>{const{t:g}=ae(),[v,S]=s.useState(null),[C,b]=s.useState({});s.useEffect(()=>{if(!n)return;(async()=>{const T={};await Promise.all(Object.keys(n).map(async M=>{const i=await je(W(I,`users/${M}`));if(i.exists()){const p=i.val(),O=p.displayName||`${p.firstName} ${p.lastName}`||p.email;T[M]={name:O}}})),b(T)})()},[n]);const w=r=>{r.stopPropagation(),S(r.currentTarget)},j=()=>{S(null)},l=()=>{R&&R(e)},x=()=>{j(),P&&P(e)},h=()=>{j(),f&&f(e,c)},k=()=>{j(),u&&u(e)},y=()=>n?t.jsx(V,{className:D.membersList,children:Object.keys(n).map(r=>{var M;const T=((M=C[r])==null?void 0:M.name)||"Miembro";return t.jsx(Te,{title:T,arrow:!0,children:t.jsx(ye,{sx:{bgcolor:ct(r),width:36,height:36,fontSize:"0.85rem"},children:dt(T)})},r)})}):null;return t.jsxs(Pe,{onClick:l,className:`${D.projectCard} ${c?D.archivedCard:""}`,elevation:4,children:[c&&t.jsx(V,{className:D.archivedBanner,children:t.jsx(N,{variant:"caption",children:g("project.archived")})}),t.jsx(Ee,{title:t.jsx(N,{variant:"h6",className:D.projectTitle,children:a}),subheader:t.jsxs(N,{variant:"body2",sx:{color:c?"#555":"white"},children:[n?g("project.membersCount",{count:Object.keys(n).length}):"",$===B&&t.jsxs(N,{variant:"caption",sx:{color:c?"#7e57c2":"primary.main",ml:1},children:["(",g("project.youAreOwner"),")"]})]}),action:t.jsxs(t.Fragment,{children:[t.jsx(xe,{onClick:w,sx:{color:c?"#555":"#ffffff"},children:t.jsx(at,{})}),t.jsxs(Ce,{anchorEl:v,open:!!v,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClick:r=>r.stopPropagation(),children:[t.jsx(q,{onClick:l,children:g("project.viewDetails")}),t.jsx(q,{onClick:x,children:g("project.edit")}),t.jsx(q,{onClick:h,children:g(c?"project.unarchive":"project.archiveLabel")}),t.jsx(q,{onClick:k,children:g("project.delete")})]})]})}),t.jsxs(ke,{children:[t.jsx(N,{variant:"body2",className:D.projectDescription,children:d||g("project.noDescription")}),o&&t.jsxs(N,{variant:"body2",className:D.projectGoal,mt:1,children:[t.jsxs("strong",{children:[g("project.goalLabel"),":"]})," ",o]}),y()]})]})},pt=({open:e,onClose:a,onSuccess:d,projectToEdit:o})=>{const{t:n}=ae(),c=de(l=>l.auth.user),[$,B]=s.useState(""),[R,P]=s.useState(""),[f,u]=s.useState(""),[g,v]=s.useState([]),[S,C]=s.useState([]),[b,w]=s.useState(!0);s.useEffect(()=>{const l=W(I,"users");ue(l,x=>{const h=x.val();if(h){const k=Object.entries(h).filter(([,y])=>y.active).map(([y,r])=>({uid:y,email:r.email,displayName:r.displayName||`${r.firstName} ${r.lastName}`,photoURL:r.photoURL||null,role:r.role}));v(k)}w(!1)})},[]),s.useEffect(()=>{o?(B(o.name),P(o.description),u(o.goal||""),C(g.filter(l=>{var x;return(x=o.members)==null?void 0:x[l.uid]}))):(B(""),P(""),u(""),C([]))},[o,g]);const j=async()=>{if(!c)return;const l={[(o==null?void 0:o.owner)||c.uid]:!0,...Object.fromEntries(S.map(h=>[h.uid,!0]))},x={name:$,description:R,goal:f,owner:(o==null?void 0:o.owner)||c.uid,members:l};try{if(o){const h=W(I,`projects/${o.id}`);await $e(h,x),se("Proyecto actualizado",{id:o.id,...x})}else{const h=Se(W(I,"projects"));await pe(h,{...x,createdAt:Date.now(),archived:!1}),se("Nuevo proyecto creado",{id:h.key,...x})}a(),d==null||d()}catch(h){Q("Error al guardar proyecto",h)}};return t.jsxs(Me,{open:e,onClose:a,fullWidth:!0,maxWidth:"sm",children:[t.jsx(Oe,{children:n(o?"project.editTitle":"project.newTitle")}),t.jsxs(Ne,{children:[t.jsx(U,{label:n("project.title"),fullWidth:!0,margin:"normal",value:$,onChange:l=>B(l.target.value)}),t.jsx(U,{label:n("project.description"),fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:R,onChange:l=>P(l.target.value)}),t.jsx(U,{label:n("project.goal"),fullWidth:!0,margin:"normal",multiline:!0,rows:2,value:f,onChange:l=>u(l.target.value)}),t.jsx(Ae,{multiple:!0,options:g,getOptionLabel:l=>l.displayName??l.email??"",value:S,onChange:(l,x)=>C(x),loading:b,renderInput:l=>t.jsx(U,{...l,label:n("project.members"),placeholder:n("project.selectMembers"),margin:"normal",InputProps:{...l.InputProps,endAdornment:t.jsxs(t.Fragment,{children:[b?t.jsx(Be,{color:"inherit",size:20}):null,l.InputProps.endAdornment]})}})})]}),t.jsxs(ze,{children:[t.jsx(X,{onClick:a,children:n("common.cancel")}),t.jsx(X,{variant:"contained",onClick:j,children:n(o?"project.saveChanges":"project.create")})]})]})},xt=()=>{const[e,a]=s.useState([]),[d,o]=s.useState([]),[n,c]=s.useState(!1),[$,B]=s.useState(""),[R,P]=s.useState(!1),f=de(i=>i.auth.user),{t:u}=ae(),g=we(),[v,S]=s.useState(null),[C,b]=s.useState(!1),[w,j]=s.useState(""),[l,x]=s.useState("success");s.useEffect(()=>{if(!f)return;const i=W(I,"projects"),p=ue(i,O=>{const A=O.val();if(A){const _=Object.entries(A).filter(([re,G])=>G.members&&typeof G.members=="object"&&f.uid in G.members).map(([re,G])=>({id:re,...G}));a(_)}else a([])});return()=>p()},[f]),s.useEffect(()=>{const i=$.toLowerCase(),p=e.filter(O=>{const A=O.name.toLowerCase().includes(i),_=O.archived===!0;return A&&(R?_:!_)});o(p)},[e,$,R]);const h=i=>{g(`/project/${i}`)},k=(i,p="success")=>{j(i),x(p),b(!0)},y=()=>{b(!1)},r=i=>{const p=e.find(O=>O.id===i);p&&p.members&&(S({id:p.id,name:p.name,description:p.description,goal:p.goal,members:p.members,owner:p.owner||""}),c(!0))},T=(i,p)=>{const O=W(I,`projects/${i}/archived`);pe(O,!p).then(()=>{k(u(p?"project.unarchived":"project.archived"),"success")}).catch(A=>{k(u("project.errorArchiving"),"error"),Q("Error al archivar/desarchivar proyecto",A)})},M=i=>{if(window.confirm(u("project.delete")+"?")){const p=W(I,`projects/${i}`);Re(p).then(()=>{k(u("project.deleted"),"success")}).catch(O=>{k(u("project.errorDeleting"),"error"),Q("Error al eliminar proyecto",O)})}};return t.jsxs(t.Fragment,{children:[t.jsxs(V,{sx:{px:4,py:3},children:[t.jsxs(K,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(K,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(De,{}),t.jsx(N,{variant:"h4",fontWeight:600,children:u("dashboard.title")})]}),t.jsx(X,{variant:"contained",startIcon:t.jsx(Le,{}),onClick:()=>c(!0),children:u("dashboard.newProject")})]}),t.jsx(pt,{open:n,onClose:()=>{c(!1),S(null)},onSuccess:()=>{c(!1),S(null),k(u(v?"project.updated":"project.created"),"success")},projectToEdit:v}),t.jsxs(K,{direction:"row",spacing:2,sx:{mt:2},children:[t.jsx(U,{label:u("dashboard.search"),variant:"outlined",fullWidth:!0,value:$,onChange:i=>B(i.target.value)}),t.jsxs(tt,{exclusive:!0,value:R?"archived":"active",onChange:(i,p)=>P(p==="archived"),children:[t.jsx(ne,{value:"active",children:u("dashboard.active")}),t.jsx(ne,{value:"archived",children:u("dashboard.archived")})]})]}),d.length===0?t.jsx(N,{variant:"body1",sx:{mt:4},children:u("dashboard.noResults")}):t.jsx(V,{sx:{display:"flex",flexWrap:"wrap",gap:2,rowGap:2,justifyContent:"flex-start",mt:3},children:d.map(i=>t.jsx(V,{sx:{flex:"1 1 300px",maxWidth:"calc(33.333% - 16px)",minWidth:"280px"},children:t.jsx(ut,{id:i.id,name:i.name,description:i.description,goal:i.goal,members:i.members,archived:i.archived,ownerId:i.owner||"",currentUserId:(f==null?void 0:f.uid)||"",onView:h,onEdit:r,onToggleArchive:T,onDelete:M})},i.id))})]}),t.jsx(We,{open:C,autoHideDuration:4e3,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(Ie,{onClose:y,severity:l,sx:{width:"100%"},children:w})})]})};export{xt as default};
